<%

value = function(val, arg1) {
    if(!val){
        return '---';
    }

    if (val instanceof Date) {
        return formatDate(new Date(val)); // Es una fecha
    }

    if (typeof val === 'string' || typeof val === 'number'){
        return titleCase(''+val);
    }
    if (arg1){
        const accesors = arg1.split('.');
        if (accesors.length) {
            const field = accesors.shift();
            if (field in val){
                return value(val[field], accesors.join('.'));
            }    
        }
        else{ // Caso base
            if (arg1 in value){
                return value(val[arg1]); // Es un atributo de un objeto
            }    
        }
    }
    if (typeof val._str_ === 'function'){
        return titleCase(val._str_())
    }
    return titleCase(''+val);
}

label = function(value) {
    if(!value){
        return '---';
    } 
    const label = (((value.split('.')).pop()).match(/[A-Z]+[^A-Z]*|[^A-Z]+/g)).join(' ');
    return titleCase(label)
}

titleCase = function(str) {
    const title =str.toLowerCase().split(' ').map(function (word) {
        return (word.charAt(0).toUpperCase() + word.slice(1));
    }).join(' ');
    return title;
}

formatDate = function(date) {
    const month = date.getMonth() + 1;
    const day = date.getDate();
    const year = date.getFullYear();
    return  day + "/" + month + "/" + year;
}

existArticulo = function(element){
    return element._id.toString() == this._id.toString() ;
}

mapTotalesPorArticulos = function(articulos, articulosAusencias){
    articulos = articulos.map(art => {
        const idx = articulosAusencias.findIndex(existArticulo, art);
        art = { 
            ausencias: (idx >= 0)? articulosAusencias[idx].ausenciasPorArticulo : 0,
            _id: art._id    
        }
        return art;
     })
     return articulos;
}

%>

